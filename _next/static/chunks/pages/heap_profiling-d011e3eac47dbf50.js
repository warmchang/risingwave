(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{84808:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/heap_profiling",function(){return t(88098)}])},95161:function(e,n,t){"use strict";t.d(n,{OL:function(){return c},X8:function(){return a},dL:function(){return s},sS:function(){return u},xv:function(){return o}});var r=t(56250),l=t(29286);async function a(){return await l.ZP.get("/metrics/cluster")}async function o(){return(await l.ZP.get("/clusters/1")).map(r.cX.fromJSON)}async function c(){return(await l.ZP.get("/clusters/2")).map(r.cX.fromJSON)}async function i(){return(await l.ZP.get("/clusters/4")).map(r.cX.fromJSON)}async function u(){let[e,n,t]=await Promise.all([c(),o(),i()]);return[...e,...n,...t]}async function s(){return await l.ZP.get("/version")}},3047:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var r=t(67294),l=t(51388);function a(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],[a,o]=(0,r.useState)(),c=(0,l.Z)();return(0,r.useEffect)(()=>{let r=async()=>{if(t)try{let n=await e();o(n)}catch(e){c(e)}};if(r(),!n)return;let l=setInterval(r,n);return()=>clearInterval(l)},[c,n,t]),{response:a}}},88098:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return P}});var r=t(85893),l=t(40639),a=t(83234),o=t(57026),c=t(47741),i=t(63764),u=t(45772),s=t.n(u),f=t(93162),d=t(9008),h=t.n(d),p=t(1864),g=t.n(p),m=t(67294),x=t(9864),v=t(56103),y=t(29286),_=t(95161),E=t(3047),w=t(56250),j=t(35049);function P(){let{response:e}=(0,E.Z)(_.sS),[n,t]=(0,m.useState)(),[u,d]=(0,m.useState)(""),[p,P]=(0,m.useState)(),[O,C]=(0,m.useState)();async function N(e,n){if(e&&n&&e.length>0)try{let e=j.R_.fromJSON(await y.ZP.get("/monitor/list_heap_profile/".concat(n)));e.nameAuto.sort().reverse(),e.nameManually.sort().reverse(),P(e),d("Successfully loaded profiling file list from ".concat(A(n),"\n\nFound ").concat(e.nameAuto.length," auto and ").concat(e.nameManually.length," manually dumped files."))}catch(e){console.error(e),d("Failed to load profiling file list from ".concat(A(n),"\n\nError: ").concat(e.message,"\nCause: ").concat(e.cause))}}async function R(){try{await y.ZP.get("/monitor/dump_heap_profile/".concat(n)),N(e,n)}catch(e){d("Dumping heap profile on ".concat(A(n),".\n\nError: ").concat(e.message,"\n").concat(e.cause))}}async function T(){let e;if(void 0===p||void 0===O){console.log("profileList: ".concat(p,", analyzeTargetFileName: ").concat(O));return}let t=g().join(p.dir,O),r=A(n);d("Analyzing ".concat(O," from ").concat(r));let l="Collapsed Profiling of ".concat(r," for ").concat(O);try{let r=s()(t),a=y.ZP.urlFor("/monitor/analyze/".concat(n,"/").concat(r)),o=await fetch(a);if(!o.ok)throw Error("".concat(o.status," ").concat(o.statusText));let c=await o.blob();(0,f.saveAs)(c,"".concat(O,".collapsed")),e="".concat(l,"\n\nDownloaded!")}catch(n){e="".concat(l,"\n\nError: ").concat(n.message)}d(e)}(0,m.useEffect)(()=>{e&&!n&&e.length>0&&t(e[0].id)},[e,n]),(0,m.useEffect)(()=>{N(e,n)},[e,n]),(0,m.useEffect)(()=>{p&&(p.nameAuto.length>0?C(p.nameAuto[0]):p.nameManually.length>0?C(p.nameManually[0]):C(void 0))},[p]);let k=[w.L3.WORKER_TYPE_COMPUTE_NODE,w.L3.WORKER_TYPE_FRONTEND,w.L3.WORKER_TYPE_COMPACTOR],S=e=>{switch(e){case w.L3.WORKER_TYPE_FRONTEND:return"Frontend";case w.L3.WORKER_TYPE_COMPUTE_NODE:return"Compute";case w.L3.WORKER_TYPE_COMPACTOR:return"Compactor";default:return"Other"}},Z=(null!=e?e:[]).reduce((e,n)=>{var t;let r=null!==(t=e.get(n.type))&&void 0!==t?t:[];return r.push(n),e.set(n.type,r),e},new Map);for(let e of Z.values())e.sort((e,n)=>e.id-n.id);let A=n=>{if(void 0===n)return"Worker Node";let t=(null!=e?e:[]).find(e=>e.id===n);return t?"Worker Node ".concat(n," (").concat(S(t.type),")"):"Worker Node ".concat(n)},M=(0,r.jsxs)(l.kC,{p:3,height:"calc(50vh - 20px)",flexDirection:"column",children:[(0,r.jsx)(v.Z,{children:"Heap Profiling"}),(0,r.jsxs)(l.kC,{flexDirection:"row",height:"full",width:"full",children:[(0,r.jsxs)(l.gC,{mr:3,spacing:3,alignItems:"flex-start",width:200,height:"full",children:[(0,r.jsxs)(a.NI,{children:[(0,r.jsx)(a.lX,{textColor:"blue.500",children:"Dump Heap Profile"}),(0,r.jsxs)(l.gC,{children:[(0,r.jsx)(a.lX,{children:"Worker Nodes"}),(0,r.jsx)(o.Ph,{onChange:e=>t(parseInt(e.target.value)),children:k.flatMap(e=>{let n=Z.get(e);return n&&0!==n.length?(0,r.jsx)("optgroup",{label:S(e),children:n.map(e=>{var n,t;return(0,r.jsxs)("option",{value:e.id,children:["(",e.id,") ",null===(n=e.host)||void 0===n?void 0:n.host,":",null===(t=e.host)||void 0===t?void 0:t.port]},e.id)})},e):[]})}),(0,r.jsx)(c.zx,{onClick:e=>R(),width:"full",children:"Dump"})]})]}),(0,r.jsxs)(a.NI,{children:[(0,r.jsx)(a.lX,{textColor:"blue.500",children:"Analyze Heap Profile"}),(0,r.jsxs)(l.gC,{children:[(0,r.jsx)(a.lX,{children:"Dumped Files"}),(0,r.jsxs)(o.Ph,{onChange:e=>C(e.target.value),children:[p&&(0,r.jsx)("optgroup",{label:"Auto",children:p.nameAuto.map(e=>(0,r.jsx)("option",{value:e,children:e},"auto-".concat(e)))}),p&&(0,r.jsx)("optgroup",{label:"Manually",children:p.nameManually.map(e=>(0,r.jsx)("option",{value:e,children:e},"manually-".concat(e)))})]}),(0,r.jsx)(c.zx,{onClick:e=>T(),width:"full",children:"Analyze"})]})]})]}),(0,r.jsx)(l.xu,{flex:1,height:"full",ml:3,overflowX:"scroll",overflowY:"scroll",children:void 0===u?(0,r.jsx)(x.Z,{}):(0,r.jsx)(i.ZP,{language:"sql",options:{fontSize:13,readOnly:!0,renderWhitespace:"boundary",wordWrap:"on"},defaultValue:'Select a worker node and target profiling result file and click "Analyze"...',value:u})})]})]});return(0,r.jsxs)(m.Fragment,{children:[(0,r.jsx)(h(),{children:(0,r.jsx)("title",{children:"Heap Profiling"})}),M]})}}},function(e){e.O(0,[876,900,851,49,888,774,179],function(){return e(e.s=84808)}),_N_E=e.O()}]);