(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[799],{31351:function(e){var t=Array.prototype.reverse;e.exports=function(e){return null==e?e:t.call(e)}},18956:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/relation_graph",function(){return n(51597)}])},60469:function(e,t,n){"use strict";n.d(t,{D:function(){return h},r:function(){return u}});var r=n(85893),l=n(79351),o=n(47741),a=n(41664),i=n.n(a),s=n(95100),c=n(55992),d=n(96402);function u(e){let[t,n]=(0,s.v1)("modalId",s.U);return[null==e?void 0:e.find(e=>e.id===t),n]}function h(e){let{modalData:t,onClose:n}=e;return(0,r.jsxs)(l.u_,{isOpen:void 0!==t,onClose:n,size:"3xl",children:[(0,r.jsx)(l.ZA,{}),(0,r.jsxs)(l.hz,{children:[(0,r.jsxs)(l.xB,{children:["Catalog of ",t&&(0,c.ks)(t)," ",null==t?void 0:t.id," - ",null==t?void 0:t.name]}),(0,r.jsx)(l.ol,{}),(0,r.jsx)(l.fe,{children:t&&(0,r.jsx)(d.Rm,{src:t,collapsed:1,name:null,displayDataTypes:!1})}),(0,r.jsxs)(l.mz,{children:[t&&(0,c.vx)(t)&&(0,r.jsx)(o.zx,{colorScheme:"blue",mr:3,children:(0,r.jsx)(i(),{href:"/fragment_graph/?id=".concat(t.id),children:"View Fragments"})}),(0,r.jsx)(o.zx,{mr:3,onClick:n,children:"Close"})]})]})]})}},96402:function(e,t,n){"use strict";n.d(t,{Rm:function(){return j},KB:function(){return S},Kf:function(){return b},gU:function(){return w},sW:function(){return k},v6:function(){return y}});var r=n(85893),l=n(47741),o=n(65914),a=n(40639),i=n(36696),s=n(63679),c=n(9008),d=n.n(c),u=n(41664),h=n.n(u),p=n(67294),x=n(56103),m=n(3047),f=n(55992);function v(e){var t,n,r,l;return"columnDesc"in e?"".concat(null===(t=e.columnDesc)||void 0===t?void 0:t.name," (").concat(null===(r=e.columnDesc)||void 0===r?void 0:null===(n=r.columnType)||void 0===n?void 0:n.typeName,")"):"".concat(e.name," (").concat(null===(l=e.dataType)||void 0===l?void 0:l.typeName,")")}var g=n(60469);let j=(0,s.ZP)(()=>n.e(171).then(n.t.bind(n,55171,23))),y=[{name:"Primary Key",width:1,content:e=>e.pk.map(e=>e.columnIndex).map(t=>e.columns[t]).map(e=>v(e)).join(", ")},{name:"Vnode Count",width:1,content:e=>{var t;return null!==(t=e.maybeVnodeCount)&&void 0!==t?t:"?"}},{name:"Data Size",width:2,content:e=>(function(e){if(void 0===e)return"unknown";if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["B","KB","MB","GB","TB"][t]})(e.totalSizeBytes)}],w={name:"Connector",width:3,content:e=>{var t;return null!==(t=e.withProperties.connector)&&void 0!==t?t:"unknown"}},b={name:"Connector",width:3,content:e=>{var t;return null!==(t=e.properties.connector)&&void 0!==t?t:"unknown"}},k=[{name:"Depends",width:1,content:e=>(0,r.jsx)(h(),{href:"/relation_graph/?id=".concat(e.id),children:(0,r.jsx)(l.zx,{size:"sm","aria-label":"view dependents",colorScheme:"blue",variant:"link",children:"D"})})},{name:"Fragments",width:1,content:e=>(0,r.jsx)(h(),{href:"/fragment_graph/?id=".concat(e.id),children:(0,r.jsx)(l.zx,{size:"sm","aria-label":"view fragments",colorScheme:"blue",variant:"link",children:"F"})})},{name:"Config Override",width:3,content:e=>{var t,n;let a=null===(n=e.streamingJob)||void 0===n?void 0:null===(t=n.configOverride)||void 0===t?void 0:t.trim();return a?(0,r.jsxs)(o.J2,{placement:"auto",trigger:"click",children:[(0,r.jsx)(o.xo,{children:(0,r.jsx)(l.zx,{size:"sm",variant:"link",colorScheme:"blue",children:"C"})}),(0,r.jsxs)(o.yk,{maxW:"lg",children:[(0,r.jsx)(o.QH,{}),(0,r.jsx)(o.us,{}),(0,r.jsx)(o.b,{fontFamily:"mono",whiteSpace:"pre-wrap",children:a})]})]}):"-"}}];function S(e,t,n,o){let{response:s}=(0,m.Z)(async()=>{let e=(null==o?void 0:o.withStreamingJobs)?(0,f.gG)():void 0,[n,r,l,a]=await Promise.all([t(),(0,f.Rf)(),(0,f.Cp)(),(0,f.jW)()]),i=e?await e:void 0,s=null==i?void 0:i.reduce((e,t)=>(e.set(t.id,t),e),new Map);return n.map(e=>{let t=r.find(t=>t.id===e.owner),n=null==t?void 0:t.name,o=a.find(t=>t.id===e.schemaId),i=null==o?void 0:o.name,c=l.find(t=>t.id===e.databaseId),d=null==c?void 0:c.name;return{streamingJob:null==s?void 0:s.get(e.id),...e,ownerName:n,schemaName:i,databaseName:d}})}),[c,u]=(0,g.r)(s),h=(0,r.jsx)(g.D,{modalData:c,onClose:()=>u(null)}),j=(0,r.jsxs)(a.xu,{p:3,children:[(0,r.jsx)(x.Z,{children:e}),s&&(0,r.jsxs)(a.xu,{mb:3,fontSize:"sm",color:"gray.600",children:["Total: ",s.length," ",1===s.length?"item":"items"]}),(0,r.jsx)(i.xJ,{children:(0,r.jsxs)(i.iA,{variant:"simple",size:"sm",maxWidth:"full",children:[(0,r.jsx)(i.hr,{children:(0,r.jsxs)(i.Tr,{children:[(0,r.jsx)(i.Th,{width:3,children:"Id"}),(0,r.jsx)(i.Th,{width:5,children:"Database"}),(0,r.jsx)(i.Th,{width:5,children:"Schema"}),(0,r.jsx)(i.Th,{width:5,children:"Name"}),(0,r.jsx)(i.Th,{width:3,children:"Owner"}),n.map(e=>(0,r.jsx)(i.Th,{width:e.width,children:e.name},e.name)),(0,r.jsx)(i.Th,{children:"Visible Columns"})]})}),(0,r.jsx)(i.p3,{children:null==s?void 0:s.map(e=>(0,r.jsxs)(i.Tr,{children:[(0,r.jsx)(i.Td,{children:(0,r.jsx)(l.zx,{size:"sm","aria-label":"view catalog",colorScheme:"blue",variant:"link",onClick:()=>u(e.id),children:e.id})}),(0,r.jsx)(i.Td,{children:e.databaseName}),(0,r.jsx)(i.Td,{children:e.schemaName}),(0,r.jsx)(i.Td,{children:e.name}),(0,r.jsx)(i.Td,{children:e.ownerName}),n.map(t=>(0,r.jsx)(i.Td,{children:t.content(e)},t.name)),e.columns&&e.columns.length>0&&(0,r.jsx)(i.Td,{overflowWrap:"normal",children:e.columns.filter(e=>!("isHidden"in e)||!e.isHidden).map(e=>v(e)).join(", ")})]},e.id))})]})})]});return(0,r.jsxs)(p.Fragment,{children:[(0,r.jsx)(d(),{children:(0,r.jsx)("title",{children:e})}),h,j]})}},51597:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var r=n(85893),l=n(40639),o=n(47741),a=n(31351),i=n.n(a),s=n(89734),c=n.n(s),d=n(9008),u=n.n(d),h=n(95100),p=n(67294),x=n(52189),m=n(49379),f=n(70681),v=n(55992),g=n(60469),j=n(23924);function y(e){let{nodes:t,selectedId:n,setSelectedId:l,channelStats:o,relationStats:a}=e,[i,s]=(0,g.r)(t.map(e=>e.relation)),c=(0,p.useRef)(null),{layoutMap:d,links:u,width:h,height:y}=(0,p.useCallback)(()=>{let e=new f.graphlib.Graph;e.setGraph({rankdir:"LR",nodesep:30,ranksep:80,marginx:30,marginy:30}),e.setDefaultEdgeLabel(()=>({})),t.forEach(t=>{e.setNode(t.id,t)}),t.forEach(t=>{var n;null===(n=t.parentIds)||void 0===n||n.forEach(n=>{e.setEdge(n,t.id)})}),f.layout(e);let n=e.nodes().map(t=>{let n=e.node(t);return{...n,x:n.x-75,y:n.y-22.5}}),r=e.edges().map(t=>{let n=e.edge(t);return{source:t.v,target:t.w,points:n.points||[]}}),{width:l,height:o}=function(e){let t=0,n=0;for(let{x:r,y:l}of e)t=Math.max(t,r+150),n=Math.max(n,l+45);return{width:t,height:n}}(n);return{layoutMap:n,links:r,width:l,height:o}},[t])();return(0,p.useEffect)(()=>{let e=Date.now(),t=c.current,r=m.Ys(t),i=m.$0Z,h=m.jvg().curve(i).x(e=>{let{x:t}=e;return t}).y(e=>{let{y:t}=e;return t}),p=r.select(".edges").selectAll(".edge").data(u),f=e=>e===n,g=e=>(e.attr("d",e=>{let{points:t}=e;return h(t)}).attr("fill","none").attr("stroke-width",e=>{if(o){let t=o.get("".concat(e.source,"_").concat(e.target));if(t)return(0,j.b4)(t.backpressureRate,15)}return 2}).attr("stroke",e=>{if(o){let t=o.get("".concat(e.source,"_").concat(e.target));if(t)return(0,j.k)(t.backpressureRate)}return x.rS.colors.gray["300"]}).attr("opacity",e=>f(e.source)||f(e.target)?1:.5),e.on("mouseover",(e,t)=>{m.td_(".tooltip").remove();let n=null==o?void 0:o.get("".concat(t.source,"_").concat(t.target)),r="<b>Relation ".concat(t.source," â†’ ").concat(t.target,"</b><br>Backpressure: ").concat(null!=n?"".concat((100*n.backpressureRate).toFixed(2),"%"):"N/A","<br>Recv Throughput: ").concat(null!=n?"".concat(n.recvThroughput.toFixed(2)," rows/s"):"N/A","<br>Send Throughput: ").concat(null!=n?"".concat(n.sendThroughput.toFixed(2)," rows/s"):"N/A");m.Ys("body").append("div").attr("class","tooltip").style("position","absolute").style("background","white").style("padding","10px").style("border","1px solid #ddd").style("border-radius","4px").style("pointer-events","none").style("left",e.pageX+10+"px").style("top",e.pageY+10+"px").style("font-size","12px").html(r)}).on("mousemove",e=>{m.Ys(".tooltip").style("left",e.pageX+10+"px").style("top",e.pageY+10+"px")}).on("mouseout",()=>{m.td_(".tooltip").remove()}),e);p.exit().remove(),p.enter().call(e=>e.append("path").attr("class","edge").call(g)),p.call(g);let y=t=>{t.attr("transform",e=>{let{x:t,y:n}=e;return"translate(".concat(t,",").concat(n,")")});let n=t.select("rect");n.empty()&&(n=t.append("rect")),n.attr("width",150).attr("height",45).attr("rx",6).attr("ry",6).attr("fill","white").attr("stroke",e=>{let{id:t}=e;return f(t)?x.rS.colors.blue["500"]:x.rS.colors.gray["200"]}).attr("stroke-width",2);let r=t.select("circle");r.empty()&&(r=t.append("circle")),r.attr("cx",22).attr("cy",22.5).attr("r",12).attr("fill",t=>{let{id:n,relation:r}=t,l=(0,v.vx)(r)?"500":"400",o=f(n)?x.rS.colors.blue[l]:x.rS.colors.gray[l];if(a){let t=parseInt(n);if(!isNaN(t)&&a[t]){let n=(0,j.Jv)(a[t].currentEpoch);return(0,j.qC)(e-n,o)}}return o});let o=t.select(".type");o.empty()&&(o=t.append("text").attr("class","type"));let i=t.select(".clip-path");i.empty()&&(i=t.append("clipPath").attr("class","clip-path").attr("id",e=>"clip-".concat(e.id))).append("rect"),i.select("rect").attr("width",106).attr("height",45).attr("x",39).attr("y",0),o.attr("fill","white").text(e=>{let{relation:t}=e;return"".concat(function(e){let t=(0,v.Mk)(e);return"SINK"===t?"K":t.charAt(0)}(t))}).attr("font-family","inherit").attr("text-anchor","middle").attr("x",22).attr("y",22.5).attr("dy","0.35em").attr("font-size",16).attr("font-weight","bold");let c=t.select(".text");c.empty()&&(c=t.append("text").attr("class","text")),c.attr("fill","black").text(e=>{let{name:t}=e;return t}).attr("font-family","inherit").attr("x",39).attr("y",22.5).attr("dy","0.35em").attr("font-size",14).attr("clip-path",e=>"url(#clip-".concat(e.id,")"));let d=(e,t)=>{var n;let r=parseInt(t),l=null==a?void 0:a[r],o=l?((Date.now()-(0,j.Jv)(l.currentEpoch))/1e3).toFixed(2):"N/A",i=null!==(n=null==l?void 0:l.currentEpoch)&&void 0!==n?n:"N/A";return"<b>".concat((0,v.ks)(e)," ").concat(t,": ").concat(e.name,"</b><br>Epoch: ").concat(i,"<br>Latency: ").concat(o," seconds")};return t.on("mouseover",(e,t)=>{let{relation:n,id:r}=t;m.td_(".tooltip").remove(),m.Ys("body").append("div").attr("class","tooltip").style("position","absolute").style("background","white").style("padding","10px").style("border","1px solid #ddd").style("border-radius","4px").style("pointer-events","none").style("left",e.pageX+10+"px").style("top",e.pageY+10+"px").style("font-size","12px").html(d(n,r))}).on("mousemove",e=>{m.Ys(".tooltip").style("left",e.pageX+10+"px").style("top",e.pageY+10+"px")}).on("mouseout",()=>{m.td_(".tooltip").remove()}),t.style("cursor","pointer").on("click",(e,t)=>{let{relation:n,id:r}=t;l(r),s(n.id)}),t},w=r.select(".boxes").selectAll(".node").data(d);w.enter().call(e=>e.append("g").attr("class","node").call(y)),w.call(y),w.exit().remove()},[d,u,n,s,l,o,a]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{ref:c,width:"".concat(h,"px"),height:"".concat(y,"px"),children:[(0,r.jsx)("g",{className:"edges"}),(0,r.jsx)("g",{className:"boxes"})]}),(0,r.jsx)(g.D,{modalData:i,onClose:()=>s(null)})]})}var w=n(17043),b=n(56103),k=n(51388),S=n(3047),T=n(70663);let C="200px";function _(){let{response:e}=(0,S.Z)(v.H4),{response:t}=(0,S.Z)(v.rs),[n,a]=(0,h.v1)("id",h.U),{response:s}=(0,S.Z)(v.xM),d=(0,k.Z)(),x=(0,p.useCallback)(()=>e&&t?function(e,t){let n=[],r=new Set(e.map(e=>e.id));for(let o of i()(c()(e,"id"))){var l;n.push({id:o.id.toString(),name:o.name,parentIds:(0,v.vx)(o)&&t.has(o.id)?null===(l=t.get(o.id))||void 0===l?void 0:l.filter(e=>r.has(e)).map(e=>e.toString()):[],order:o.id,width:150,height:45,relation:o})}return n}(e,t):void 0,[e,t])(),[m,f]=(0,p.useState)(),[g,j]=(0,p.useState)(),[_,N]=(0,p.useState)();(0,p.useEffect)(()=>{let e;let t=(0,T.P)({setChannelStats:f,setRelationStats:j,toast:d},e,"relation",_);t();let n=setInterval(t,5e3);return()=>{clearInterval(n)}},[d,_]);let z=(0,p.useMemo)(()=>{if(!s)return new Map;let e=s.fragmentToRelationMap;if(m){let t=new Map;for(let[n,r]of m){let[l,o]=n.split("_").map(Number),a=e[o],i=e[l];if(a&&i&&a!==i){let e="".concat(i,"_").concat(a);t.set(e,r)}}return t}},[m,s]),D=(0,r.jsxs)(l.kC,{p:3,height:"calc(100vh - 20px)",flexDirection:"column",children:[(0,r.jsx)(b.Z,{children:"Relation Graph"}),(0,r.jsxs)(l.kC,{flexDirection:"row",height:"full",children:[(0,r.jsx)(l.kC,{width:C,height:"full",maxHeight:"full",mr:3,alignItems:"flex-start",flexDirection:"column",children:(0,r.jsx)(l.xu,{flex:1,overflowY:"scroll",children:(0,r.jsxs)(l.gC,{width:C,align:"start",spacing:3,children:[(0,r.jsx)(w.Z,{onApply:(e,t)=>{N({at:e,timeOffset:t})}}),(0,r.jsx)(l.xv,{fontWeight:"semibold",mb:3,children:"Relations"}),null==e?void 0:e.map(e=>{let t=n===e.id;return(0,r.jsx)(o.zx,{colorScheme:t?"blue":"gray",color:t?"blue.600":"gray.500",variant:t?"outline":"ghost",py:0,height:8,justifyContent:"flex-start",onClick:()=>a(e.id),children:e.name},e.id)})]})})}),(0,r.jsxs)(l.xu,{flex:1,height:"full",ml:3,overflowX:"scroll",overflowY:"scroll",children:[(0,r.jsx)(l.xv,{fontWeight:"semibold",children:"Relation Graph"}),x&&(0,r.jsx)(y,{nodes:x,selectedId:null==n?void 0:n.toString(),setSelectedId:e=>a(parseInt(e)),channelStats:z,relationStats:g})]})]})]});return(0,r.jsxs)(p.Fragment,{children:[(0,r.jsx)(u(),{children:(0,r.jsx)("title",{children:"Relation Graph"})}),D]})}}},function(e){e.O(0,[662,476,914,184,876,278,591,240,273,851,441,49,393,888,774,179],function(){return e(e.s=18956)}),_N_E=e.O()}]);